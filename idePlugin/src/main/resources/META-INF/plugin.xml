<!--
  CodeNodeIO IDE Plugin
  Flow-Based Programming visual editor for JetBrains IDEs
  License: Apache 2.0
-->

<idea-plugin>
    <!-- Plugin ID - must be unique across all plugins -->
    <id>io.codenode.ide-plugin</id>

    <!-- Plugin Name - displayed in marketplace and plugin manager -->
    <name>CodeNodeIO</name>

    <!-- Plugin Vendor Information -->
    <vendor email="support@codenode.io" url="https://codenode.io">CodeNode.IO</vendor>

    <!-- Plugin Description -->
    <description><![CDATA[
        <h2>CodeNodeIO - Flow-Based Programming for Full-Stack Development</h2>

        <p>
        CodeNodeIO is a CAD-like visual editor for creating full-stack applications using Flow-Based Programming (FBP)
        principles. Design complex data flows visually, generate production-ready code for Kotlin Multiplatform
        (Android, iOS, Web) and Go backends.
        </p>

        <h3>Key Features:</h3>
        <ul>
            <li><strong>Visual Flow Graph Editor</strong> - Drag-and-drop nodes and connections to design your application logic</li>
            <li><strong>Hybrid Visual/Textual View</strong> - Switch between graphical and textual representations</li>
            <li><strong>Multi-Platform Code Generation</strong> - Generate KMP code for Android, iOS, and Web frontends</li>
            <li><strong>Go Backend Generation</strong> - Generate server-side code for Go-based services</li>
            <li><strong>Real-Time Validation</strong> - Catch errors early with type checking and graph validation</li>
            <li><strong>Circuit Simulator</strong> - Debug and visualize data flow execution with pause/resume controls</li>
        </ul>

        <h3>Based on Flow-Based Programming:</h3>
        <p>
        Following J. Paul Morrison's FBP principles, CodeNodeIO treats applications as networks of
        asynchronous processes that communicate via typed data streams (Information Packets).
        </p>

        <h3>Supported IDEs:</h3>
        <ul>
            <li>IntelliJ IDEA (Community & Ultimate)</li>
            <li>Android Studio</li>
            <li>GoLand</li>
        </ul>
    ]]></description>

    <!-- Change Notes - updated with each release -->
    <change-notes><![CDATA[
        <h3>Version 0.1.0 (Preview)</h3>
        <ul>
            <li>Visual flow graph viewer in tool window</li>
            <li>.flow.kts file type recognition</li>
            <li>KMP code generation from flow graphs</li>
        </ul>
    ]]></change-notes>

    <!-- Compatibility: IntelliJ Platform 2024.1+ (build 241) through 2025.x (build 252+) -->
    <idea-version since-build="241.0" until-build="259.*"/>

    <!-- Plugin Dependencies -->
    <depends>com.intellij.modules.platform</depends>
    <!-- Note: Kotlin plugin dependency removed to avoid K2 mode incompatibility.
         We parse .flow.kts files as text using our own DSL parser. -->

    <!-- Extensions -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- File Type for .flow.kts files -->
        <fileType
            name="FlowGraph"
            implementationClass="io.codenode.ideplugin.filetype.FlowGraphFileType"
            fieldName="INSTANCE"
            extensions="flow.kts"/>

        <!-- Tool Window: Graph Editor -->
        <toolWindow
            id="CodeNodeIO Graph Editor"
            anchor="right"
            icon="AllIcons.Toolwindows.ToolWindowBuild"
            factoryClass="io.codenode.ideplugin.toolwindow.GraphEditorToolWindowFactory"/>

        <!-- Project Service for managing flow graphs -->
        <projectService serviceImplementation="io.codenode.ideplugin.services.FlowGraphManager"/>

        <!-- Project Service for code generation -->
        <projectService serviceImplementation="io.codenode.ideplugin.services.CodeGenerationService"/>

        <!-- Notification group for plugin notifications -->
        <notificationGroup id="CodeNodeIO" displayType="BALLOON"/>
    </extensions>

    <!-- Actions -->
    <actions>
        <!-- Main Menu: Tools > CodeNodeIO -->
        <group id="CodeNodeIO.MainMenu" text="CodeNodeIO" description="CodeNodeIO FBP Tools" popup="true">
            <add-to-group group-id="ToolsMenu" anchor="last"/>

            <action
                id="CodeNodeIO.NewFlowGraph"
                class="io.codenode.ideplugin.actions.NewFlowGraphAction"
                text="New Flow Graph"
                description="Create a new flow-based programming graph"
                icon="AllIcons.Actions.AddFile">
                <keyboard-shortcut first-keystroke="control alt N" keymap="$default"/>
            </action>

            <action
                id="CodeNodeIO.OpenGraphEditor"
                class="io.codenode.ideplugin.actions.OpenGraphEditorAction"
                text="Open Graph Editor"
                description="Open the visual graph editor"
                icon="AllIcons.Actions.Edit">
                <keyboard-shortcut first-keystroke="control alt G" keymap="$default"/>
            </action>

            <separator/>

            <action
                id="CodeNodeIO.GenerateKMPCode"
                class="io.codenode.ideplugin.actions.GenerateKMPCodeAction"
                text="Generate KMP Code"
                description="Generate Kotlin Multiplatform code from flow graph"
                icon="AllIcons.Actions.Compile">
            </action>

            <!-- TODO: These actions will be implemented in future phases
            <action
                id="CodeNodeIO.ValidateGraph"
                class="io.codenode.ideplugin.actions.ValidateFlowGraphAction"
                text="Validate Flow Graph"
                description="Validate the current flow graph for errors"
                icon="AllIcons.Actions.BuildLoadChanges">
                <keyboard-shortcut first-keystroke="control alt V" keymap="$default"/>
            </action>

            <separator/>

            <action
                id="CodeNodeIO.GenerateGoCode"
                class="io.codenode.ideplugin.actions.GenerateGoCodeAction"
                text="Generate Go Code"
                description="Generate Go backend code from flow graph"
                icon="AllIcons.Actions.Compile">
            </action>

            <separator/>

            <action
                id="CodeNodeIO.OpenCircuitSimulator"
                class="io.codenode.ideplugin.actions.OpenCircuitSimulatorAction"
                text="Open Circuit Simulator"
                description="Open the circuit simulator for debugging data flow"
                icon="AllIcons.Actions.StartDebugger">
            </action>
            -->
        </group>

        <!-- Context Menu Actions for .flow.kts files -->
        <group id="CodeNodeIO.EditorPopupMenu">
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <separator/>
            <action
                id="CodeNodeIO.OpenInGraphEditor"
                class="io.codenode.ideplugin.actions.OpenCurrentFileInGraphEditorAction"
                text="Open in Graph Editor"
                description="Open this flow graph in the visual editor"
                icon="AllIcons.Actions.Edit"/>
            <reference ref="CodeNodeIO.GenerateKMPCode"/>
        </group>

        <!-- Project View Context Menu Actions -->
        <group id="CodeNodeIO.ProjectViewPopupMenu">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
            <separator/>
            <reference ref="CodeNodeIO.NewFlowGraph"/>
            <action
                id="CodeNodeIO.OpenInGraphEditorFromProject"
                class="io.codenode.ideplugin.actions.OpenCurrentFileInGraphEditorAction"
                text="Open in Graph Editor"
                description="Open this flow graph in the visual editor"
                icon="AllIcons.Actions.Edit"/>
        </group>
    </actions>
</idea-plugin>
